# Git flow для Destruction Sandbox

## Типы веток

В Git flow используются следующие типы веток:
- `main`: основная ветка, содержащая стабильный код, и все релизы.
- `develop`: ветка для интеграции новых функций и изменений, которая служит основой для разработки.
- `feature/#<id>`: головные ветки для разработки фич, состоящих из нескольких задач
- `task/#<id>`: рабочие ветки для выполнения конкретных задач и исправления багов
- `release/X.Y.Z`: ветки для подготовки к выпуску новой версии
- `sdk/web`: ветка для сборки и специфичных доработок Web SDK
- `sdk/android`: ветка для сборки и специфичных доработок Android SDK
- `sdk/ios`: ветка для сборки и специфичных доработок iOS SDK
- `sdk/*`: ветки для других платформ по мере необходимости

---

## Нейминг веток

Ветки feature и task должны именоваться в формате: `<type>/#<id>`, где `<type>` - это тип ветки (feature или task), а `<id>` - уникальный идентификатор задачи или функции, связанной с этой веткой. Например:
- `feature/#123`: ветка для разработки новой функции с идентификатором 123
- `task/#456`: рабочая ветка для задачи с идентификатором 456

Релизные ветки должны именоваться в формате: `release/X.Y.Z`, где `X.Y.Z` - номер версии. Например:
- `release/1.0.0`: ветка для подготовки к выпуску версии

SDK-ветки именуются в формате: `sdk/<platform>`, где `<platform>` - целевая платформа (web, android, ios и т.д.)

---

## Коммиты

Сообщения коммитов должны содержать идентификатор задачи.

Формат:
- `[#<id>] <краткое описание изменений>`

Примеры:
- `[#42] add inventory window`
- `[#87] fix save loading crash`
- `[#103] [web-sdk] add touch controls support`
- `[#104] [android-sdk] fix memory leak in texture loader`

Правила:
- один коммит — одно логически завершённое изменение
- для SDK-специфичных изменений добавлять префикс платформы в квадратных скобках

---

## Работа с feature-ветками и рабочими ветками

### Feature-ветка

`feature/#<id>` используется для разработки фичи, которая состоит из нескольких задач.

Feature-ветка является общей головной веткой для разработки фичи и используется всей командой в процессе работы над ней.

Особенности feature-ветки:
- в feature-ветку постепенно попадают результаты выполнения отдельных задач через слияние рабочих веток
- feature-ветка должна **всегда находиться в рабочем и собираемом состоянии**
- перед слиянием рабочей ветки в feature-ветку изменения должны быть проверены на корректность работы
- feature-ветка не предназначена для экспериментов и временно ломающих изменений
- после завершения всех задач по фиче feature-ветка сливается обратно в `develop`

### Рабочая ветка

`task/#<id>` используется для работы над конкретной задачей.

Рабочая ветка всегда имеет чёткую область ответственности и короткий жизненный цикл.

Правила создания рабочей ветки:
- если задача является частью конкретной фичи, рабочая ветка создаётся от соответствующей `feature/#<feature_id>`
- если задача не относится к какой-либо фиче, рабочая ветка создаётся напрямую от `develop`
- если задача относится к SDK-специфичной функциональности, рабочая ветка создаётся от соответствующей `sdk/<platform>`

### SDK-ветки

`SDK/<platform>` ветки используются для:
- поддержки специфичных для платформы фич и исправлений
- сборки и публикации SDK для конкретной платформы
- тестирования платформо-специфичной функциональности

Особенности SDK-веток:
- создаются от `develop` и поддерживаются в актуальном состоянии
- содержат платформо-специфичные настройки, конфигурации сборки и адаптации
- изменения из `develop` периодически интегрируются в SDK-ветки
- SDK-специфичные изменения сначала тестируются в соответствующих SDK-ветках, затем переносятся в `develop` через Pull Request

## Источник веток

- `feature/#<id>` → создаётся от `develop`
- `task/#<id>` → создаётся от `develop`, `feature/#<id>` или `sdk/<platform>`
- `release/X.Y.Z` → создаётся от `develop`
- `sdk/web` → создаётся от `develop`, поддерживается отдельно
- `sdk/android` → создаётся от `develop`, поддерживается отдельно
- `sdk/ios` → создаётся от `develop`, поддерживается отдельно
- `sdk/*` → создаётся от `develop` для других платформ

## Правила слияния веток и ответственности

Для поддержания стабильности основных веток и прозрачности процесса разработки вводятся следующие правила слияния веток.

---

### Слияние рабочих веток в feature-ветку

- Слияние рабочей ветки (`task/#<id>`) в соответствующую `feature/#<id>` выполняет **исполнитель задачи**.
- Исполнитель несёт ответственность за:
    - корректность реализации задачи
    - работоспособность кода
    - отсутствие поломок в feature-ветке
- Перед слиянием рабочая ветка должна быть проверена и находиться в рабочем состоянии.
- Pull Request для слияния рабочей ветки в feature-ветку не обязателен и используется по необходимости.

---

### Слияние рабочих и feature-веток в develop

- Слияние:
    - рабочих веток (`task/#<id>`, созданных напрямую от `develop`)
    - feature-веток (`feature/#<id>`)
    - SDK-специфичных изменений из `sdk/<platform>`

  в ветку `develop` выполняет **тимлид**.

- Слияние в `develop` осуществляется **только через Pull Request**.
- Pull Request используется для:
    - финальной проверки изменений
    - контроля качества
    - подтверждения готовности изменений к интеграции
    - проверки кроссплатформенной совместимости

---

### Слияние веток с исправлениями в release-кандидат

- Слияние веток `task/#<id>`, содержащих исправления, предназначенные для релиз-кандидата, в ветку `release/X.Y.Z` выполняет **тимлид**.
- Слияние осуществляется **только через Pull Request**.
- В релизную ветку допускаются только изменения, направленные на:
    - исправление ошибок
    - стабилизацию
    - подготовку к релизу

---

### Слияние релизной ветки

- Слияние ветки `release/X.Y.Z`:
    - в `main`
    - и обратно в `develop`

  выполняет **тимлид**.

- После слияния релизной ветки:
    - релиз помечается тегом версии
    - релизная ветка удаляется
    - изменения синхронизируются с SDK-ветками

---

### Работа с SDK-ветками

#### Обновление SDK-веток из develop
- Регулярное обновление SDK-веток из `develop` выполняется **тимлидом** или **ответственным за SDK**.
- Процесс:
  1. Создание Pull Request из `develop` в `sdk/<platform>`
  2. Проверка совместимости изменений с целевой платформой
  3. Тестирование сборки на целевой платформе
  4. Слияние после успешной проверки

#### SDK-специфичные изменения
- Изменения, специфичные для конкретной платформы, сначала разрабатываются в соответствующей `sdk/<platform>` ветке.
- После тестирования и проверки, изменения переносятся в `develop` через Pull Request, если они имеют ценность для других платформ.
- Платформо-специфичные багфиксы сначала применяются в SDK-ветке, затем, при необходимости, портируются в `develop`.

#### Сборка и публикация SDK
- Сборка SDK для публикации выполняется из соответствующей `sdk/<platform>` ветки.
- Каждая публикация SDK помечается тегом в формате `sdk/<platform>/X.Y.Z`.
- Стабильные версии SDK также мержатся в `main` с соответствующими тегами.

---

### Общие правила

- Прямые коммиты в `main` и `develop` запрещены.
- Ответственность за стабильность `develop` и `main` несёт тимлид.
- Каждый Pull Request должен соответствовать правилам Git Flow проекта.
- Изменения, затрагивающие несколько платформ, должны тестироваться на всех затронутых платформах перед слиянием в `develop`.

---

## Процесс релиза

### Основной релиз (Game)
1. Создать ветку `release/X.Y.Z` от `develop`
2. Внести финальные правки:
    - исправление багов
    - обновление версий
    - правки документации
3. Проверить совместимость с SDK-ветками
4. Слить `release/X.Y.Z` в `main`
5. Пометить релиз тегом `X.Y.Z`
6. Слить изменения из `main` обратно в `develop`
7. Обновить SDK-ветки из `develop` (через Pull Request)

### SDK релиз
1. Убедиться, что соответствующая `sdk/<platform>` ветка актуальна относительно `develop`
2. Создать ветку `release/sdk/<platform>/X.Y.Z` от `sdk/<platform>`
3. Выполнить платформо-специфичную подготовку к релизу
4. Собрать и протестировать SDK
5. Слить релизную ветку SDK в `main` с тегом `sdk/<platform>/X.Y.Z`
6. Обновить `sdk/<platform>` ветку из `main`

---

## Версионирование

Используется схема `MAJOR.MINOR.PATCH`.

Теги релизов:
- Основной игры: `0.1.0`, `0.1.1`, `1.0.0`
- SDK релизы: `sdk/web/1.2.0`, `sdk/android/2.0.0`, `sdk/ios/1.5.3`

## Синхронизация между ветками

Для поддержания консистентности кодовой базы:

1. **Еженедельная синхронизация**: тимлид обновляет SDK-ветки из `develop`
2. **После каждого релиза**: изменения из `main` синхронизируются со всеми SDK-ветками
3. **Перед крупными изменениями**: проверяется влияние на все платформы
4. **Кроссплатформенное тестирование**: обязательное для изменений, затрагивающих ядро игры

## Данный Git Flow является обязательным для всех участников проекта.
